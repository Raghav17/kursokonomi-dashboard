<!DOCTYPE html>
<html lang="no">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kalkulator for kursøkonomi</title>
    <!-- Tailwind CSS via CDN -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
    />
    <!-- Chart.js for charts (vanilla JS library) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      /* Glassy card style without @apply */
      .glass-card {
        backdrop-filter: blur(12px);
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 1rem;
      }
    </style>
  </head>
  <body class="bg-gradient-to-b from-blue-50 to-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold text-center mb-8">Kalkulator for kursøkonomi</h1>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Input section -->
        <div class="glass-card">
          <h2 class="text-xl font-semibold mb-4">Inndata</h2>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium mb-1">Annonsebudsjett (kr):</label>
              <input
                id="adsBudget"
                type="number"
                class="w-full p-2 border rounded"
                value="50000"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Kurspris (kr):</label>
              <input
                id="coursePrice"
                type="number"
                class="w-full p-2 border rounded"
                value="3990"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Unike klikk:</label>
              <input
                id="uniqueClicks"
                type="number"
                class="w-full p-2 border rounded"
                value="1200"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Leads (registreringer):</label>
              <input
                id="leads"
                type="number"
                class="w-full p-2 border rounded"
                value="600"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Oppmøteprosent (%):</label>
              <input
                id="showUpRate"
                type="number"
                class="w-full p-2 border rounded"
                value="35"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Kjøpsprosent (%):</label>
              <input
                id="purchaseRate"
                type="number"
                class="w-full p-2 border rounded"
                value="8"
              />
            </div>
          </div>
        </div>
        <!-- Output section -->
        <div class="glass-card">
          <h2 class="text-xl font-semibold mb-4">Resultater</h2>
          <ul class="space-y-2 text-sm">
            <li><strong>Konvertering landingsside:</strong> <span id="conversionRate">0%</span></li>
            <li><strong>CPL (kostnad per registrering):</strong> <span id="cpl">0 kr</span></li>
            <li><strong>Antall salg:</strong> <span id="salesCount">0</span></li>
            <li><strong>Omsetning:</strong> <span id="revenue">0 kr</span></li>
            <li><strong>ROAS:</strong> <span id="roas">0%</span></li>
            <li><strong>Dekningsbidrag:</strong> <span id="coverageContribution">0 kr</span></li>
            <li><strong>Maks tolerert CPL (break-even):</strong> <span id="breakEvenCpl">0 kr</span></li>
            <li><strong>Leads til break-even:</strong> <span id="leadsForBreakeven">0</span></li>
          </ul>
        </div>
      </div>
      <!-- Charts -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
        <div class="glass-card">
          <h2 class="text-xl font-semibold mb-4">Funnel</h2>
          <canvas id="funnelChart" width="400" height="300"></canvas>
        </div>
        <div class="glass-card">
          <h2 class="text-xl font-semibold mb-4">Budsjett vs omsetning</h2>
          <canvas id="revenueChart" width="400" height="300"></canvas>
        </div>
      </div>
    </div>
    <script>
      // Helper to format numbers in Norwegian locale
      function formatNumber(num, decimals = 0) {
        return new Intl.NumberFormat('nb-NO', { minimumFractionDigits: decimals, maximumFractionDigits: decimals }).format(num);
      }

      // Initialize charts
      const funnelCtx = document.getElementById('funnelChart').getContext('2d');
      const revenueCtx = document.getElementById('revenueChart').getContext('2d');
      const funnelChart = new Chart(funnelCtx, {
        type: 'bar',
        data: {
          labels: ['Unike klikk', 'Leads', 'Oppmøte', 'Salg'],
          datasets: [
            {
              label: 'Antall',
              backgroundColor: ['#3b82f6', '#3b82f6', '#3b82f6', '#3b82f6'],
              borderColor: '#3b82f6',
              borderWidth: 1,
              data: [0, 0, 0, 0],
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true },
          },
        },
      });
      const revenueChart = new Chart(revenueCtx, {
        type: 'bar',
        data: {
          labels: ['Budsjett', 'Omsetning'],
          datasets: [
            {
              label: 'Beløp',
              backgroundColor: ['#f59e0b', '#10b981'],
              borderColor: ['#f59e0b', '#10b981'],
              borderWidth: 1,
              data: [0, 0],
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true },
          },
        },
      });

      // Function to compute and update all values
      function updateDashboard() {
        const adsBudget = parseFloat(document.getElementById('adsBudget').value) || 0;
        const coursePrice = parseFloat(document.getElementById('coursePrice').value) || 0;
        const uniqueClicks = parseFloat(document.getElementById('uniqueClicks').value) || 0;
        const leads = parseFloat(document.getElementById('leads').value) || 0;
        const showUpRate = parseFloat(document.getElementById('showUpRate').value) || 0;
        const purchaseRate = parseFloat(document.getElementById('purchaseRate').value) || 0;

        const conversionRate = uniqueClicks > 0 ? (leads / uniqueClicks) * 100 : 0;
        const cpl = leads > 0 ? adsBudget / leads : 0;
        const salesCount = leads * (showUpRate / 100) * (purchaseRate / 100);
        const revenue = salesCount * coursePrice;
        const roas = adsBudget > 0 ? (revenue / adsBudget) * 100 : 0;
        const breakEvenCpl = coursePrice * (showUpRate / 100) * (purchaseRate / 100);
        const leadsForBreakeven = breakEvenCpl > 0 ? adsBudget / breakEvenCpl : 0;
        const coverageContribution = revenue - adsBudget;

        // Update text outputs
        document.getElementById('conversionRate').innerText = conversionRate.toFixed(2) + '%';
        document.getElementById('cpl').innerText = formatNumber(cpl, 2) + ' kr';
        document.getElementById('salesCount').innerText = formatNumber(salesCount);
        document.getElementById('revenue').innerText = formatNumber(revenue) + ' kr';
        document.getElementById('roas').innerText = roas.toFixed(1) + '%';
        document.getElementById('coverageContribution').innerText = formatNumber(coverageContribution) + ' kr';
        document.getElementById('breakEvenCpl').innerText = formatNumber(breakEvenCpl, 2) + ' kr';
        document.getElementById('leadsForBreakeven').innerText = formatNumber(leadsForBreakeven);

        // Update funnel chart
        funnelChart.data.datasets[0].data = [uniqueClicks, leads, leads * (showUpRate / 100), salesCount];
        funnelChart.update();
        // Update revenue chart
        revenueChart.data.datasets[0].data = [adsBudget, revenue];
        revenueChart.update();
      }

      // Attach event listeners to inputs
      ['adsBudget', 'coursePrice', 'uniqueClicks', 'leads', 'showUpRate', 'purchaseRate'].forEach((id) => {
        document.getElementById(id).addEventListener('input', updateDashboard);
      });
      // Initial update on page load
      updateDashboard();
    </script>
  </body>
</html>